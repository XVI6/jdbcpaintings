package paintingsjdbc.service;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.List;

import paintingsjdbc.domain.*;

public class ReproductorManager {
	
	private Connection connection;
	
	private String url= "jdbc:hsqldb:hsql://localhost/workdb";
	
	
	private String createTableReproductor = "CREATE TABLE Reproductor ("
			+ "idReproduktor INTEGER GENERATED BY DEFAULT AS IDENTITY, "
			+ "name VARCHAR(20), country VARCHAR(20), "
			+ "city VARCHAR(20), adress VARCHAR(50),"
			+ "house_num VARCHAR(7), telephone VARCHAR(50), "
			+ "e_mail VARCHAR(50),"
			+ "PRIMARY KEY(idReproduktor))";
	
	
	private PreparedStatement getAllReproductorStmt;

	private PreparedStatement deleteFromPaintingStmt;
	
	private PreparedStatement addReproductorStmt;
	
	//private PreparedStatement updateReproductorStmt;
	
	
	
	private Statement statement;
	
	
	public ReproductorManager(){
		
		try {
			connection = DriverManager.getConnection(url);
			statement = connection.createStatement();
			
			ResultSet result = connection.getMetaData().getTables(null, null, null, null);
			boolean table = false;
			
			while (result.next()) {
				if ("Reproductor".equalsIgnoreCase(result.getString("TABLE_NAME"))) {
					table = true;
					break;
				}
			}
			
			if (!table) {
				
				statement.executeUpdate(createTableReproductor);
				
				
				getAllReproductorStmt = connection.prepareStatement("SELECT * FROM Reproductor");
				
				
				deleteFromPaintingStmt = connection.prepareStatement("DELETE FROM Painting WHERE idReproduktor = ?");
				
				addReproductorStmt = connection.prepareStatement("INSERT INTO Reproductor ( name, country, city, adress, telephone, e_mail ) VALUES (?, ?, ?, ?, ?, ?)");
				
				//updateReproductorStmt = connection.prepareStatement("UPDATE Reproductor SET name = ?, country = ?, city = ?, adress = ?, telephone = ?, e_mail = ? WHERE idReproduktor = ?");

				
			}
			
		} catch (SQLException e) {
			// TODO: handle exception
			e.printStackTrace();
		}	
	}
	
	
	// 0 
		Connection getConnection() {
			return connection;
		}
	
	// 2 -- getAllReproductorStmt
	// +
	public List<Reproduktor> getAllReproductor() {
		List<Reproduktor> reproduktors = new ArrayList<Reproduktor>();
		
		try {
			ResultSet result = getAllReproductorStmt.executeQuery();
			
			while (result.next()) {
				Reproduktor r = new Reproduktor();
				r.setId(result.getInt("id"));
				r.setName(result.getString("name"));
				r.setCountry(result.getString("country"));
				r.setCity(result.getString("city"));
				r.setAdress(result.getString("adress"));
				r.setTelephone(result.getString("telephone"));
				r.setE_mail(result.getString("e_mail"));
				reproduktors.add(r);
			}
		} catch (SQLException e) {
			// TODO: handle exception
			e.printStackTrace();
		}
		return reproduktors;
	}
	
	// 4 -- deleteFromPainting
	// +
	public int deleteFromPainting(Painting painting) {
		
		int counter = 0;
		try {
			deleteFromPaintingStmt.setLong(1, painting.getId());// 3 - 1
			
			counter = deleteFromPaintingStmt.executeUpdate();
			
		} catch (SQLException e) {
			// TODO: handle exception
			e.printStackTrace();
		}
		
		return counter;
	}
	
	// 5 -- addReproductor
	// +
	public int addReproductor(Reproduktor reproduktor) {
		int counter = 0;
		
		try {
			
			addReproductorStmt.setString(1, reproduktor.getName());
			addReproductorStmt.setString(2, reproduktor.getCountry());
			addReproductorStmt.setString(3, reproduktor.getCity());
			addReproductorStmt.setString(4, reproduktor.getAdress());
			addReproductorStmt.setString(5, reproduktor.getTelephone());
			addReproductorStmt.setString(6, reproduktor.getE_mail());
			
			counter = addReproductorStmt.executeUpdate();
			
		} catch (SQLException e) {
			// TODO: handle exception
			e.printStackTrace();
		}
		return counter;
	}
	
	
	
	
	
}
